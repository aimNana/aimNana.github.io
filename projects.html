<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projects — aimNana</title>
  <meta name="description" content="Auto-generated project list from GitHub repositories."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css?v=3">
</head>
<body>
  <header>
    <div class="hero">
      <a href="index.html" class="btn secondary">← Back</a>
      <div>
        <h1>Projects</h1>
        <p>Case studies with features, tech stacks and links — generated from GitHub.</p>
      </div>
      <nav class="cta">
        <a class="btn" href="index.html#contact">Contact</a>
        <!-- Theme slider -->
        <label class="theme-switch" title="Toggle dark mode">
          <input type="checkbox" id="theme-toggle" aria-label="Toggle dark mode">
          <span class="track">
            <span class="icon sun" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zM1 13h3v-2H1v2zm10-9h2V1h-2v3zm7.04 2.46l1.79-1.8-1.41-1.41-1.8 1.79 1.42 1.42zM17 13h3v-2h-3v2zM11 23h2v-3h-2v3zm7.66-3.95l1.41-1.41-1.79-1.8-1.42 1.42 1.8 1.79zM4.24 17.24l-1.8 1.79 1.41 1.41 1.8-1.79-1.41-1.41zM12 8a4 4 0 100 8 4 4 0 000-8z"/>
              </svg>
            </span>
            <span class="icon moon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
              </svg>
            </span>
            <span class="thumb"></span>
          </span>
        </label>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="card" style="grid-column:1/-1">
      <h2>Projects</h2>
      <p class="lead">Public repositories fetched from GitHub. Add the <code>featured</code> or <code>portfolio</code> topic on a repo to pin it here first.</p>
      <div id="project-list" class="project-auto-list" aria-live="polite"></div>
    </section>
  </main>

  <footer>
    <small>© <span id="year"></span> <strong>aimNana</strong> · Projects Page</small>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Theme init + slider
    document.addEventListener('DOMContentLoaded', () => {
      const STORAGE_KEY = 'theme';
      const root = document.documentElement;
      const input = document.getElementById('theme-toggle');
      const applyTheme = (t) => {
        if (t === 'dark') { root.setAttribute('data-theme','dark'); if (input) input.checked = true; }
        else { root.removeAttribute('data-theme'); if (input) input.checked = false; }
      };
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) applyTheme(saved);
      else if (window.matchMedia('(prefers-color-scheme: dark)').matches) applyTheme('dark');
      if (input) input.addEventListener('change', () => {
        const next = input.checked ? 'dark' : 'light';
        applyTheme(next);
        localStorage.setItem(STORAGE_KEY, next);
      });
    });

    // ------- Build projects from GitHub -------
    async function fetchJSON(url){
      const r = await fetch(url, {
        headers: {
          'Accept': 'application/vnd.github+json',
          'X-GitHub-Api-Version': '2022-11-28'
        }
      });
      if(!r.ok) throw new Error('GitHub API error: ' + r.status);
      return r.json();
    }

    function repoImagePath(username, repoName){
      return `assets/img/${repoName}.jpg`;
    }

    function makeProjectCard(username, repo, topics, languages){
      const container = document.createElement('article');
      container.className = 'card project-detail auto';

      // Head area
      const head = document.createElement('div');
      head.className = 'pd-head';

      const img = document.createElement('img');
      img.className = 'pd-shot';
      img.alt = repo.name + ' preview';
      img.src = repoImagePath(username, repo.name);
      img.onerror = () => {
        if (!img.dataset.triedLower) {
          img.dataset.triedLower = '1';
          img.src = repoImagePath(username, repo.name.toLowerCase());
        } else {
          head.style.gridTemplateColumns = '1fr';
          img.remove();
        }
      };

      const meta = document.createElement('div');
      meta.className = 'pd-meta';

      const h2 = document.createElement('h2');
      h2.textContent = repo.name;

      const desc = document.createElement('p');
      desc.className = 'lead';
      desc.textContent = repo.description || '—';

      const badges = document.createElement('div');
      badges.className = 'pd-badges';

      // topics first (featured, portfolio, etc.)
      (topics || []).forEach(t => {
        const b = document.createElement('span');
        b.className = 'badge';
        b.textContent = t;
        badges.appendChild(b);
      });

      // languages summary (top 2)
      const langs = Object.entries(languages || {}).sort((a,b)=>b[1]-a[1]).slice(0,2);
      if(langs.length){
        const b = document.createElement('span');
        b.className = 'badge';
        b.textContent = langs.map(x=>x[0]).join(' · ');
        badges.appendChild(b);
      }

      const links = document.createElement('div');
      links.className = 'pd-links';

      // Live link (homepage or GitHub Pages)
      const live = repo.homepage?.trim()
        ? repo.homepage.trim()
        : (repo.has_pages ? `https://${username}.github.io/${repo.name}/` : '');

      if(live){
        const a = document.createElement('a');
        a.className = 'btn';
        a.href = live;
        a.target = '_blank';
        a.rel = 'noopener';
        a.textContent = 'Live';
        links.appendChild(a);
      }

      const repoBtn = document.createElement('a');
      repoBtn.className = 'btn secondary';
      repoBtn.href = repo.html_url;
      repoBtn.target = '_blank';
      repoBtn.rel = 'noopener';
      repoBtn.textContent = 'Repository';
      links.appendChild(repoBtn);

      meta.append(h2, desc, badges, links);
      head.append(img, meta);
      container.appendChild(head);

      // Body: small meta list
      const body = document.createElement('div');
      body.className = 'pd-body';
      const left = document.createElement('div');
      const right = document.createElement('div');

      left.innerHTML = `
        <h3>Highlights</h3>
        <ul class="pd-list">
          <li>Updated: ${new Date(repo.pushed_at).toLocaleDateString()}</li>
          <li>Stars: ${repo.stargazers_count}</li>
          <li>Default branch: ${repo.default_branch}</li>
        </ul>
      `;
      right.innerHTML = `
        <h3>Tech Stack</h3>
        <ul class="pd-list">
          ${langs.map(([k])=>`<li>${k}</li>`).join('') || '<li>—</li>'}
        </ul>
      `;
      body.append(left, right);
      container.appendChild(body);

      return container;
    }

    async function buildProjects(username){
      const root = document.getElementById('project-list');
      root.innerHTML = '<div class="repo">Loading projects…</div>';

      try{
        // 1) repos
        const repos = await fetchJSON(`https://api.github.com/users/${username}/repos?per_page=100`);

        // 2) prepare list: non-forks, sort by activity, cap to 20 to reduce rate limit hits
        const enrich = repos
          .filter(r => !r.fork)
          .sort((a,b) => new Date(b.pushed_at) - new Date(a.pushed_at))
          .slice(0, 20);

        // 3) topics + languages (parallel)
        const withTopics = await Promise.all(enrich.map(async r => {
          let topics = [], languages = {};
          try {
            const t = await fetchJSON(`https://api.github.com/repos/${username}/${r.name}/topics`);
            topics = t.names || [];
          } catch {}
          try {
            languages = await fetchJSON(`https://api.github.com/repos/${username}/${r.name}/languages`);
          } catch {}
          return { repo: r, topics, languages };
        }));

        // featured/portfolio first
        const featured = withTopics.filter(x => x.topics.includes('featured') || x.topics.includes('portfolio'));
        const others   = withTopics.filter(x => !featured.includes(x));

        root.innerHTML = '';
        for(const x of [...featured, ...others]){
          root.appendChild(makeProjectCard(username, x.repo, x.topics, x.languages));
        }
        if(!root.children.length){
          root.innerHTML = '<div class="repo">No public repositories found.</div>';
        }
      }catch(e){
        root.innerHTML = '<div class="repo">Could not load repositories (rate limit or network).</div>';
      }
    }

    buildProjects('aimnana');
  </script>
</body>
</html>
